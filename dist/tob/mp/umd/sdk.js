!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).$$LOGSDK=t()}(this,(function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function a(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=s(e);if(t){var r=s(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return a(this,n)}}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}function h(){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=c(e,t);if(!i)return;var r=Object.getOwnPropertyDescriptor(i,t);if(r.get)return r.get.call(arguments.length<3?e:n);return r.value},h.apply(this,arguments)}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,r,s=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(s.push(i.value),!t||s.length!==t);o=!0);}catch(e){a=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw r}}return s}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function v(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}var g,y=void 0,m="cn",k={cn:"https://mcs.volceapplog.com",va:"https://mcs.itobsnssdk.com",sg:"https://mcs.tobsnssdk.com"},_={appOnShow:"app_launch",appOnHide:"app_terminate",appOnError:"on_error",pageOnShow:"predefine_pageview",pageOnHide:"predefine_pageview_hide",pageOnShareAppMessage:"on_share",pageOnAddToFavorites:"on_addtofavorites"},b=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"],w=["__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append"],O=function(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)},S=function(e){return"function"==typeof e},P=function(e){return"number"==typeof e&&!isNaN(e)},A=function(){return+new Date},I=function(){function e(n){t(this,e),this.sdk=n,this.env=this.init()}return i(e,[{key:"init",value:function(){return{user:{web_id:y,user_unique_id:y,user_id:y,user_type:y,user_is_auth:y,user_is_login:y,ip_addr_id:y,device_id:y},header:{app_id:y,app_name:y,app_install_id:y,install_id:y,app_package:y,app_channel:y,app_version:y,os_name:y,os_version:y,device_model:y,device_brand:y,traffic_type:y,client_ip:y,os_api:y,access:y,language:y,app_language:y,creative_id:y,ad_id:y,campaign_id:y,ab_client:y,ab_version:y,platform:y,sdk_version:y,sdk_lib:y,app_region:y,region:y,province:y,city:y,timezone:y,tz_offset:y,tz_name:y,sim_region:y,carrier:y,resolution:y,screen_width:y,screen_height:y,browser:y,browser_version:y,referrer:y,referrer_host:y,utm_source:y,utm_medium:y,utm_campaign:y,utm_term:y,utm_content:y,custom:{},ab_sdk_version:y,_sdk_version:y,_sdk_name:y,wechat_openid:y,wechat_unionid:y}}}},{key:"set",value:function(e){var t=this;this.sdk.emit(this.sdk.types.EnvTransform,e),Object.keys(e).forEach((function(n){if("evtParams"===n)t.evtParams=Object.assign(Object.assign({},t.evtParams||{}),e.evtParams||{});else if("_staging_flag"===n)t.evtParams=Object.assign(Object.assign({},t.evtParams||{}),{_staging_flag:e._staging_flag});else{var i=n,r=e[n];if(null===r)return!1;var s="";if(i.indexOf(".")>-1){var o=f(i.split("."),2);s=o[0],i=o[1]}"platform"===i&&(r="mp"),"os_version"!==i&&"mp_platform"!==i||(r="".concat(r)),s?("headers"===s&&(s="header"),"user"===s||"header"===s?t.env[s][i]=r:t.env.header.custom[i]=r):t.env.user.hasOwnProperty(i)?["user_type","ip_addr_id"].indexOf(i)>-1?t.env.user[i]=Number(r):["user_id","web_id","user_unique_id"].indexOf(i)>-1?t.env.user[i]=String(r):["user_is_auth","user_is_login"].indexOf(i)>-1?t.env.user[i]=Boolean(r):["device_id"].indexOf(i)>-1&&(t.env.user[i]=r):t.env.header.hasOwnProperty(i)?t.env.header[i]=r:t.env.header.custom[i]=r}}))}},{key:"get",value:function(e){if(!e||"env"===e)return this.clone(this.env);if("evtParams"===e)return Object.assign({},this[e]);if(this.env.hasOwnProperty(e))return this.clone(this.env[e]);if(this.env.user.hasOwnProperty(e))return this.clone(this.env.user[e]);if(this.env.header.hasOwnProperty(e))return this.clone(this.env.header[e]);if(this.env.header.custom.hasOwnProperty(e))return this.clone(this.env.header.custom[e])}},{key:"compose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this.env,i=n.user,r=n.header,s=this.evtParams,o=e.map((function(e){return e.event&&!t.includes(e.event)&&s&&Object.keys(s).forEach((function(t){void 0===e.params[t]&&(e.params[t]=s[t])})),e.params=JSON.stringify(e.params),e}));return this.clone({events:o,user:i,header:r})}},{key:"merge",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this.compose(e,t);return n.local_time=Math.floor(A()/1e3),[n]}},{key:"clone",value:function(e){if(O(e))return JSON.parse(JSON.stringify(e));return e}}]),e}(),C=function(){function e(){t(this,e),this.domains=k,this.init()}return i(e,[{key:"init",value:function(){this.option={caller:"",log:!1,channel:m,report_channel:m,channel_domain:"",report_url:"",auto_report:false,auto_profile:false,profile_channel:"cn",enable_profile:false,enable_ab_test:false,ab_channel_domain:"",clear_ab_cache_on_user_change:true,enable_et_test:false,event_verify_url:"",enable_buffer:false,buffer_interval:5e3,buffer_number:5,enable_storage_only:false,enable_filter_list:false,enable_third:false,enable_filter_crawler:false,request_timeout:0,enable_initiative_launch:false,enable_custom_webid:false,disable_sdk_monitor:false},this.cloneOption=Object.assign({},this.option),this.initDomain()}},{key:"initDomain",value:function(){if(this.option.channel_domain)return this.domain=this.option.channel_domain,void 0;var e=this.option.report_channel;Object.keys(this.domains).includes(e)||(e=m),this.domain=this.domains[e]}},{key:"set",value:function(e){var t=this;if(!O(e))return;Object.keys(e).forEach((function(n){t.option.hasOwnProperty(n)&&("channel"===n||"report_channel"===n?(t.option.report_channel=t.option.channel=e[n]?e[n]:t.cloneOption[n],t.initDomain()):(t.option[n]=void 0===e[n]?t.cloneOption[n]:e[n],"channel_domain"===n&&t.initDomain()))}))}},{key:"get",value:function(e){if(e){if(this.hasOwnProperty(e))return this[e];if(this.option.hasOwnProperty(e))return this.option[e];return}return Object.assign({},this.option)}}]),e}(),j=function(){function e(){t(this,e),this.hooks={}}return i(e,[{key:"on",value:function(e,t){if(!e||!t||"function"!=typeof t)return;this.hooks[e]||(this.hooks[e]=[]),this.hooks[e].push(t)}},{key:"once",value:function(e,t){var n=this;if(!e||!t||"function"!=typeof t)return;this.on(e,(function i(r){t(r),n.off(e,i)}))}},{key:"off",value:function(e,t){if(!e||!this.hooks[e]||!this.hooks[e].length)return;if(t){var n=this.hooks[e].indexOf(t);-1!==n&&this.hooks[e].splice(n,1)}else this.hooks[e]=[]}},{key:"emit",value:function(e,t){if(!e||!this.hooks[e]||!this.hooks[e].length)return;l(this.hooks[e]).forEach((function(e){try{e(t)}catch(e){}}))}}]),e}(),E=function(){function e(n){t(this,e),this.ready=!1,this.sdk=n}return i(e,[{key:"setLog",value:function(e){e&&S(e.log)&&(this._log=e)}},{key:"setRequest",value:function(e){if(S(e)){var t=e(this.sdk);S(t)&&(this._request=t)}}},{key:"setStorage",value:function(e){O(e)&&S(e.get)&&S(e.set)&&S(e.remove)&&(this._storage=e)}},{key:"check",value:function(){if(!this._request||!this._storage)return;this.ready=!0}},{key:"log",value:function(){if(!this._log)return;try{var e;this.sdk.option.get("log")&&(e=this._log).log.apply(e,arguments)}catch(e){}}},{key:"request",value:function(e){var t;if(!this.ready)return Promise.reject();try{return null===(t=this._request)||void 0===t?void 0:t.call(this,e)}catch(e){}}},{key:"get",value:function(e){if(!this.ready)return Promise.reject(null);return this._storage.get(e)}},{key:"set",value:function(e,t){if(!this.ready)return Promise.reject(!1);return this._storage.set(e,t)}},{key:"remove",value:function(e){if(!this.ready)return Promise.reject(!1);return this._storage.remove(e)}}]),e}();!function(e){e.Init="$init",e.Config="$config",e.Send="$send",e.Ready="$ready",e.TokenComplete="$token-complete",e.TokenStorage="$token-storage",e.TokenFetch="$token-fetch",e.TokenGet="$token-get",e.LaunchComplete="$launch-complete",e.ConfigUuid="$config-uuid",e.ConfigWebId="$config-webid",e.ConfigTransform="$config-transform",e.UuidChangeBefore="$uuid-change-before",e.UuidChangeAfter="$uuid-change-after",e.EnvTransform="$env-transform",e.Event="$event",e.Report="$report",e.AppOpen="$app-open",e.AppClose="$app-close",e.AppShowStart="$app-show-start",e.AppShow="$app-show",e.AppHide="$app-hide",e.AppError="$app-error",e.AppShare="$app-share",e.AppOnShare="$app-on-share",e.PageShow="$page-show",e.PageHide="$page-hide",e.PageShare="$page-share",e.SubmitBefore="$submit-before",e.SubmitAfter="$submit-after",e.SubmitError="$submit-error",e.FilterCrawler="$filter-crawler",e.LaunchInfo="$launch-info",e.AbVar="$ab-var",e.AbAllVars="$ab-all-vars",e.AbExternalVersion="$ab-external-version",e.AbVersionChangeOn="$ab-version-change-on",e.AbVersionChangeOff="$ab-version-change-off",e.AbRefresh="$ab-refresh",e.AbFetchAfter="$ab-fetch-After",e.ProfileSet="$profile-set",e.ProfileSetOnce="$profile-set-once",e.ProfileUnset="$profile-unset",e.ProfileIncrement="$profile-increment",e.ProfileAppend="$profile-append",e.ProfileClear="$profile-clear",e.ProfileSubmitAfter="$profile-submit-after",e.ProfileSubmitError="$profile-submit-error",e.TransformInfo="$transform-info",e.ExtendAppLaunch="$extend-app-launch",e.ExtendAppTerminate="$extend-app-terminate",e.ExtendAppError="$extend-app-error",e.ExtendPageShow="$extend-page-show",e.ExtendPageHide="$extend-page-hide",e.ExtendPageShare="$extend-page-share",e.ExtendPageFavorite="$extend-page-favorite"}(g||(g={}));var x=g,q=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},T=function(){function e(){t(this,e),this.types=x,this.EventType=_,this.ProfileType=w,this.UtmType=b,this.SdkHook=x,this.inited=!1,this.sended=!1,this.pluginInstances=[],this.data=new Map,this.ready=!1,this.sessionId="",this.env=new I(this),this.option=new C,this.hook=new j,e.instances.push(this);try{this.adapter=new E(this),this.adapter.setLog(e._log),this.adapter.setRequest(e._request),this.adapter.setStorage(e._storage),this.adapter.check(),e.plugins.reduce((function(e,t){var n=t.plugin;return e.push(new n),e}),this.pluginInstances)}catch(e){}}return i(e,[{key:"on",value:function(e,t){var n;null===(n=this.hook)||void 0===n?void 0:n.on(e,t)}},{key:"once",value:function(e,t){var n;null===(n=this.hook)||void 0===n?void 0:n.once(e,t)}},{key:"off",value:function(e,t){var n;if(!t&&this.types[e])return;null===(n=this.hook)||void 0===n?void 0:n.off(e,t)}},{key:"emit",value:function(e,t){var n;this.adapter.log("emit ".concat(e),t||""),null===(n=this.hook)||void 0===n||n.emit(e,t)}},{key:"appId",get:function(){return this._appId}},{key:"checkUsePlugin",value:function(t){return!!e.plugins.find((function(e){return e.name===t}))}},{key:"init",value:function(e){var t=this;if(this.inited||!O(e))return;var n=e.app_id,i=e.log,r=v(e,["app_id","log"]);if(void 0!==i&&this.option.set({log:i}),!(P(n)&&n>0))return this.adapter.log("app_id invalid"),void 0;this._appId=n,this.option.set(r),this.env.set({app_id:n}),Promise.all([new Promise((function(e){t.once(x.TokenComplete,(function(){e(!0)}))})),new Promise((function(e){t.checkUsePlugin("official:auto")?t.on(x.LaunchComplete,(function(){e(!0)})):e(!0)})),new Promise((function(e){t.sended?e(!0):t.once(x.Send,(function(){e(!0)}))}))]).then((function(){t.ready=!0,t.emit(x.Ready)}));var s=this.option.get();if(this.pluginInstances.forEach((function(e){e.apply(t,s)})),this.get("is-crawler"))return;this.inited=!0,this.emit(x.Init),this.sessionId=q(),this.on(x.AppShowStart,(function(){t.sessionId=q()}))}},{key:"config",value:function(e){if(!this.inited||!O(e))return;this.emit(x.Config,e);var t=e.web_id,n=e.user_unique_id,i=v(e,["web_id","user_unique_id"]);void 0!==t&&this.emit(x.ConfigWebId,t),void 0!==n&&this.emit(x.ConfigUuid,n),this.env.set(i)}},{key:"send",value:function(){if(!this.inited||this.sended)return;this.sended=!0,this.emit(x.Send)}},{key:"event",value:function(e,t){var n=this;if(this.get("is-crawler"))return;if(Array.isArray(e)){var i=A(),r=[];e.forEach((function(e){var t,s,o;if(Array.isArray(e)){var a=f(e,3);t=a[0],s=a[1],o=a[2]}else O(e)&&(t=e.event,s=e.params,o=e.local_time_ms);if(!t)return;(!P(o)||o<0||o>i)&&(o=i),r.push(n.createEvent({event:t,params:s,time:o}))})),r.length>0&&this.emit(x.Event,r)}else this.emit(x.Event,this.createEvent({event:e,params:t}))}},{key:"createEvent",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Object.assign({event:e.event,params:e.params||{},local_time_ms:e.time||A()},this.sessionId?{session_id:this.sessionId}:{});if(!t)return n;var i="",r=this.get("ab_sdk_version");r&&(i+=r);var s=this.get("ab_sdk_version_external");return s&&(i?i+=","+s:i=s),Object.assign(Object.assign({},n),i?{ab_sdk_version:i}:{})}},{key:"set",value:function(e,t){this.data.set(e,t)}},{key:"get",value:function(e){return this.data.get(e)}},{key:"getKey",value:function(e){var t=this.appId;if("ab_version"===e||"ab_version_external"===e)return"__tea_sdk_".concat(e,"_").concat(t);var n={token:"tokens",report:"reports",event:"events",utm:"utm",first:"first",compensate:"compensate"};return n[e]?"__tea_cache_".concat(n[e],"_").concat(t):void 0}},{key:"getUrl",value:function(e){var t=this.option,n=this.env,i=n.get("_sdk_version"),r=(n.get("_sdk_name")||"").replace(/@.+\//,""),s="".concat(t.get("domain")).concat(e,"?sdk_version=").concat(i,"&sdk_name=").concat(r),o=t.get("caller");if(o)return"".concat(s,"&app_id=").concat(this.appId,"&caller=").concat(o);return s}},{key:"getToken",value:function(e){var t=this;if(e)return this.emit(x.TokenGet,{callback:e}),void 0;return new Promise((function(e){t.emit(x.TokenGet,{callback:function(t){e(t)}})}))}},{key:"getConfig",value:function(e){return this.env.get(e||"header")}},{key:"stash",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="stash";this.set(n,[].concat(l(this.get(n)||[]),[this.createEvent({event:e,params:t})]))}},{key:"commit",value:function(){var e="stash",t=this.get(e)||[];t.length>0&&(this.event(t),this.set(e,[]))}},{key:"getVar",value:function(e,t,n){var i=this;if(n)return this.emit(x.AbVar,{name:e,defaultValue:t,callback:n}),void 0;return new Promise((function(n){i.emit(x.AbVar,{name:e,defaultValue:t,callback:function(e){n(e)}})}))}},{key:"getAllVars",value:function(e){var t=this;if(e)return this.emit(x.AbAllVars,e),void 0;return new Promise((function(e){t.emit(x.AbAllVars,(function(t){e(t)}))}))}},{key:"getAbSdkVersion",value:function(){var e=this.get("ab_versions")||[];return e.length>0?e[e.length-1].ab:""}},{key:"onAbSdkVersionChange",value:function(e){var t=this;return this.emit(x.AbVersionChangeOn,e),function(){t.emit(x.AbVersionChangeOff,e)}}},{key:"offAbSdkVersionChange",value:function(e){this.emit(x.AbVersionChangeOff,e)}},{key:"setExternalAbVersion",value:function(e){this.emit(x.AbExternalVersion,"string"==typeof e&&e?"".concat(e).trim():null)}},{key:"getAbConfig",value:function(e,t){var n=this;if(t)return this.emit(x.AbRefresh,{params:e,callback:t}),void 0;return new Promise((function(t){n.emit(x.AbRefresh,{params:e,callback:function(e){t(e)}})}))}},{key:"profileSet",value:function(e){this.emit(x.ProfileSet,e)}},{key:"profileSetOnce",value:function(e){this.emit(x.ProfileSetOnce,e)}},{key:"profileUnset",value:function(e){this.emit(x.ProfileUnset,e)}},{key:"profileIncrement",value:function(e){this.emit(x.ProfileIncrement,e)}},{key:"profileAppend",value:function(e){this.emit(x.ProfileAppend,e)}},{key:"autoInitializationRangers",value:function(e){var t=e.onTokenReady,n=v(e,["onTokenReady"]);return this.init(Object.assign(Object.assign({},n),{log:!1,enable_third:!0})),this.send(),this.getToken().then((function(e){var n=e.web_id;try{if("function"==typeof t)return t("".concat(n)),void 0}catch(e){}return"".concat(n)}))}}],[{key:"useAdapterLog",value:function(t){e._log=t}},{key:"useAdapterRequest",value:function(t){e._request=t}},{key:"useAdapterStorage",value:function(t){e._storage=t}},{key:"usePlugin",value:function(t,n){var i=n||t.pluginName;if(i){for(var r=!1,s=0,o=e.plugins.length;s<o;s++){if(e.plugins[s].name===i){e.plugins[s].plugin=t,r=!0;break}}r||e.plugins.push({name:i,plugin:t})}else e.plugins.push({plugin:t});if("function"==typeof t.init)try{t.init(e)}catch(e){}}}]),e}();T.plugins=[],T.instances=[];var U,N="2.1.2",$=function(){function e(){t(this,e)}return i(e,[{key:"apply",value:function(e,t){e.env.set({sdk_version:N,_sdk_version:N,_sdk_name:"@datarangers/sdk-mp"})}}]),e}();$.pluginName="official:info",function(e){e.Default="default",e.Custom="custom"}(U||(U={}));var V=function(){function e(n,i){t(this,e),this.wrap=n,this.sdk=i,this.url="/webid/"}return i(e,[{key:"storageNoData",value:function(){this.fetch()}},{key:"storageHasData",value:function(e){return this.wrap.dataComplete(e)}},{key:"fetch",value:function(){var e=this,t=this.sdk,n=t.adapter,i=t.appId;n.request({url:this.sdk.getUrl("".concat(this.url)),method:"POST",data:{app_id:i,url:"-",user_agent:"-",referer:"-",user_unique_id:""}}).then((function(t){try{var i=t.data,r=(i=void 0===i?{}:i).e,s=void 0===r?-1e4:r,o=i.web_id,a=void 0===o?"":o;if(0===s)return e.fetchComplete(a),void 0;n.log("parse web_id error",s)}catch(e){n.log("parse web_id error",e)}e.fetchComplete()})).catch((function(t){e.fetchComplete(),n.log("fetch web_id error",t)}))}},{key:"fetchComplete",value:function(e){if(!e)return;this.wrap.webIdComplete(e)}},{key:"storageComplete",value:function(e){if(!e)return this.storageNoData(),void 0;try{if(e[this.wrap.typeKey]===U.Default){var t=this.storageHasData(e);this.wrap.complete(t)}else this.storageNoData()}catch(e){}}}]),e}(),L=function(){function e(n,i){var r=this;t(this,e),this.wrap=n,this.sdk=i,this.sdk.on(this.sdk.types.ConfigWebId,(function(e){e="".concat(e),r.wrap.tokenComplete?r.waitComplete(e):r.waitResolve?r.waitResolve(e):r.tmpWebId=e}))}return i(e,[{key:"storageNoData",value:function(){this.wait()}},{key:"storageHasData",value:function(e){return this.wrap.dataComplete(e,this.tmpWebId)}},{key:"wait",value:function(){var e=this;new Promise((function(t){void 0!==e.tmpWebId?(t(e.tmpWebId),e.tmpWebId=void 0):e.waitResolve=t})).then((function(t){e.waitComplete(t)}))}},{key:"waitComplete",value:function(e){this.wrap.webIdComplete(e)}},{key:"storageComplete",value:function(e){if(!e)return this.storageNoData(),void 0;try{if(e[this.wrap.typeKey]===U.Custom){var t=this.storageHasData(e);this.wrap.complete(t)}else this.storageNoData()}catch(e){}}}]),e}(),R=function(){function e(){t(this,e),this.tokenComplete=!1,this.tobid="",this.tobidUrl="/tobid/",this.tobidKey="",this.isCustom=!1,this.typeKey="_type_"}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t,this.key=this.sdk.getKey("token"),this.tobidKey="diss".split("").reverse().join(""),this.options.enable_custom_webid?(this.isCustom=!0,this.token=new L(this,this.sdk)):(this.isCustom=!1,this.token=new V(this,this.sdk));var i=this.sdk.types;this.sdk.on(i.ConfigUuid,(function(e){n.setUserUniqueId(e)})),this.sdk.on(i.TokenGet,(function(e){var t=e.callback,r=function(){n.fetchTobid().then((function(){var e=n.sdk.env.get("user"),i=Object.assign(Object.assign({},e),{web_id:n.webId,user_unique_id:n.userUniqueId});i[n.tobidKey]=n.tobid,"function"==typeof t&&t(i)}))};n.sdk.ready?r():n.sdk.once(i.Ready,(function(){r()}))})),this.storage()}},{key:"storage",value:function(){var e=this,t=this.sdk.adapter;t.get(this.key).then((function(n){if(!O(n)||!n.web_id)return e.storageComplete(null),void 0;n[e.typeKey]&&!n[e.tobidKey]&&n.user_unique_id||(n={web_id:n.web_id,user_unique_id:n.user_unique_id||n.web_id},t.set(e.key,n)),e.storageComplete(n)})).catch((function(n){e.storageComplete(null),t.log("get token error",n)}))}},{key:"storageComplete",value:function(e){this.token.storageComplete(e)}},{key:"dataComplete",value:function(e,t){var n=e.web_id;void 0!==t&&t!==n&&(n=t),this.webId=n;var i=e.web_id===e.user_unique_id?n:e.user_unique_id;return void 0!==this.tmpUserUniqueId&&this.tmpUserUniqueId!==i&&(i=this.tmpUserUniqueId?this.tmpUserUniqueId:n,this.tmpUserUniqueId=void 0),this.userUniqueId=i,n!==e.web_id||i!==e.user_unique_id}},{key:"webIdComplete",value:function(e){this.webId=e,this.tmpUserUniqueId?(this.userUniqueId=this.tmpUserUniqueId,this.tmpUserUniqueId=void 0):this.userUniqueId=e,this.complete(!0)}},{key:"complete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.sdk.types,n={web_id:this.webId,user_unique_id:this.userUniqueId};this.sdk.env.set(n),n[this.typeKey]=this.isCustom?U.Custom:U.Default,e&&this.sdk.adapter.set(this.key,n),this.tokenComplete=!0,this.sdk.emit(t.TokenComplete)}},{key:"setUserUniqueId",value:function(e){var t,n,i,r=this.sdk,s=r.adapter,o=r.env,a=r.types;if(this.tokenComplete){if(this.userUniqueId===e)return;this.sdk.emit(a.UuidChangeBefore),this.userUniqueId=e||this.webId,o.set({user_unique_id:this.userUniqueId});var u=(t={web_id:this.webId,user_unique_id:this.userUniqueId},n=this.typeKey,i=this.isCustom?U.Custom:U.Default,n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t);s.set(this.key,u),this.sdk.emit(a.UuidChangeAfter)}else this.tmpUserUniqueId=e}},{key:"fetchTobid",value:function(){var e=this,t=this.sdk,n=t.adapter,i=t.appId;return n.request({url:this.sdk.getUrl("".concat(this.tobidUrl)),method:"POST",data:{app_id:i,web_id:this.webId,user_unique_id:this.userUniqueId}}).then((function(t){try{var n=t.data,i=(n=void 0===n?{}:n).e,r=void 0===i?-1e4:i,s=n.tobid,o=void 0===s?"":s;if(0===r)return e.tobid=o,void 0}catch(e){}})).catch((function(e){n.log("fetch tobid error",e)}))}}]),e}();R.pluginName="official:token";var H=function(){function e(){t(this,e),this.url="/list/",this.cache=[]}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t,this.key=this.sdk.getKey("report"),this.reportUrl=this.sdk.getUrl("".concat(this.url)),this.sdk.set("report_url",this.reportUrl);var i=this.sdk.types;this.sdk.on(i.Report,(function(e){if(Array.isArray(e)||(e=[e]),!n.sdk.ready)return e.forEach((function(e){return n.cache.push(e)})),void 0;n.report(e)})),this.sdk.on(i.Ready,(function(){n.cache.length>0&&(n.report(l(n.cache)),n.cache.length=0)}));var r=this.sdk.adapter;this.sdk.on(i.AppOpen,(function(){r.get(n.key).then((function(){}))})),this.sdk.on(i.AppClose,(function(){n.cache.length>0&&(r.set(n.key,l(n.cache)),n.cache.length=0)}))}},{key:"report",value:function(e){this.submit(e)}},{key:"submit",value:function(e){var t=this,n=this.sdk.types;this.sdk.emit(n.SubmitBefore,e),this.sdk.adapter.request({url:this.reportUrl,method:"POST",data:e}).then((function(i){t.sdk.emit(n.SubmitAfter,{isError:!1,response:i,event:e})})).catch((function(i){t.sdk.emit(n.SubmitAfter,{isError:!0,error:i,event:e}),t.sdk.emit(n.SubmitError,{event:e})}))}}]),e}();H.pluginName="official:report";var D=function(){function e(){t(this,e),this.buffer=[],this.timer=0,this.unReadyCache=[]}return i(e,[{key:"apply",value:function(e,t){var n,i,r=this;this.sdk=e,this.options=t,this.enable=!!this.options.enable_buffer;var s=!0===this.options.enable_storage||!1===this.options.disable_storage;if(s&&(this.enable=!0),this.enable){this.interval=this.options.buffer_interval,this.number=this.options.buffer_number,s&&((null===(n=this.options)||void 0===n?void 0:n.report_interval)>0&&(this.interval=this.options.report_interval),(null===(i=this.options)||void 0===i?void 0:i.max_batch_event)>0&&(this.number=this.options.max_batch_event));try{this.interval=Number(this.interval),this.number=Number(this.number)}catch(e){}}this.sdk.set("enable_storage",this.enable);var o=this.sdk.types;this.sdk.on(o.Event,(function(e){if(!r.sdk.ready)return r.unReadyCache=[].concat(l(r.unReadyCache),l(Array.isArray(e)?e:[e])),void 0;r.process(Array.isArray(e)?e:[e])})),this.sdk.on(o.Ready,(function(){r.unReadyCache.length>0&&(r.process(r.unReadyCache),r.unReadyCache=[])})),this.sdk.on(o.AppClose,(function(){r.buffer.length>0&&(r.report(r.buffer),r.buffer.length=0)}))}},{key:"process",value:function(e){var t=this.sdk.env.compose(e);if(!this.enable)return this.report(t),void 0;this.buffer=[].concat(l(this.buffer),[t]),this.refresh()}},{key:"refresh",value:function(){var e=this;this.timer&&clearTimeout(this.timer),this.buffer.length>=this.number?(this.report(l(this.buffer)),this.buffer.length=0):this.timer=setTimeout((function(){e.report(l(e.buffer)),e.buffer.length=0}),this.interval)}},{key:"report",value:function(e){this.sdk.emit(this.sdk.types.Report,e)}}]),e}();D.pluginName="official:buffer";var M=function(){function e(){t(this,e)}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t;var i=this.sdk,r=i.types,s=i.env,o=function(){try{var e=(new Date).getTimezoneOffset();return{timezone:Math.floor(Math.abs(e)/60),offset:60*e}}catch(e){return{timezone:8,offset:-28800}}}();s.set({timezone:o.timezone,tz_offset:o.offset}),this.sdk.on(r.ConfigTransform,(function(e){if(void 0!==e.gender&&([1,2,"1","2"].includes(e.gender)?e.gender=e.gender<2?"male":"female":delete e.gender),!!n.options.enable_profile){var t={};["nick_name","gender","avatar_url"].forEach((function(n){void 0!==e[n]&&(t[n]=e[n],delete e[n])})),n.sdk.emit(r.ProfileSet,t)}})),this.sdk.on(r.EnvTransform,(function(e){if(!!n.options.enable_profile){var t={};["$mp_from_uuid"].forEach((function(n){void 0!==e[n]&&(t[n]=e[n],delete e[n])})),Object.keys(t).length>0&&n.sdk.emit(r.ProfileSetOnce,t)}}))}}]),e}();M.pluginName="official:transform";var K=function(){function e(){t(this,e),this.url="/profile/list",this.lastId=0,this.lastOnceId=0,this.duration=6e4,this.cache={},this.buffer=[]}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t;var i=this.sdk.types;this.sdk.on(i.ProfileSet,(function(e){n.check()&&n.setProfile(e)})),this.sdk.on(i.ProfileSetOnce,(function(e){n.check()&&n.setOnceProfile(e)})),this.sdk.on(i.ProfileUnset,(function(e){n.check()&&n.unsetProfile(e)})),this.sdk.on(i.ProfileIncrement,(function(e){n.check()&&n.incrementProfile(e)})),this.sdk.on(i.ProfileAppend,(function(e){n.check()&&n.appendProfile(e)})),this.sdk.on(i.ProfileClear,(function(){n.cache={}})),this.sdk.on(i.Ready,(function(){if(!n.buffer.length)return;n.reportMore(l(n.buffer)),n.buffer=[]}))}},{key:"check",value:function(){return!!this.options.enable_profile}},{key:"setProfile",value:function(e){var t=this,n=this.debounce(e);if(!n)return;this.putCache(n);var i=this.filter(n,(function(e){return t.isString(e)||t.isNumber(e)||t.isArray(e)}));this.report(this.sdk.createEvent({event:"__profile_set",params:i}))}},{key:"setOnceProfile",value:function(e){var t=this,n=this.debounce(e,!0);if(!n)return;this.putCache(n);var i=this.filter(n,(function(e){return t.isString(e)||t.isNumber(e)||t.isArray(e)}));this.report(this.sdk.createEvent({event:"__profile_set_once",params:i}))}},{key:"incrementProfile",value:function(e){var t=this;if(!e)return;var n=this.filter(e,(function(e){return t.isNumber(e)}));this.report(this.sdk.createEvent({event:"__profile_increment",params:n}))}},{key:"unsetProfile",value:function(e){if(!e||!this.isString(e))return;var t={};t[e]="1",this.report(this.sdk.createEvent({event:"__profile_unset",params:t}))}},{key:"appendProfile",value:function(e){var t=this;if(!e||!this.isObject(e)||this.isEmpty(e))return;var n=this.filter(e,(function(e){return t.isString(e)||t.isArray(e)}));this.report(this.sdk.createEvent({event:"__profile_append",params:n}))}},{key:"reportMore",value:function(e){var t=this;if(this.sdk.ready){var n=this.sdk.env.merge(e,this.sdk.ProfileType),i=this.sdk,r=i.adapter,s=i.option;r.request({url:"".concat(s.get("domain")).concat(this.url),method:"POST",data:n}).then((function(e){t.sdk.emit(t.sdk.types.ProfileSubmitAfter,{isError:!0,response:e,event:n})})).catch((function(e){t.sdk.emit(t.sdk.types.ProfileSubmitError,{isError:!0,error:e,event:n})}))}else e.forEach((function(e){t.buffer.push(e)}))}},{key:"report",value:function(e){this.reportMore([e])}},{key:"ms",value:function(){return A()}},{key:"debounce",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e||!this.isObject(e)||this.isEmpty(e))return;var i=Object.keys(e),r=this.ms(),s=i.filter((function(i){var s=t.cache[i];if(s&&(n||t.compare(s.val,e[i])&&r-s.timestamp<t.duration))return!1;return!0})).reduce((function(t,n){return t[n]=e[n],t}),{});if(!(i=Object.keys(s)).length)return;return s}},{key:"putCache",value:function(e){var t=this,n=this.ms();Object.keys(e).forEach((function(i){t.cache[i]={val:t.clone(e[i]),timestamp:n}}))}},{key:"clone",value:function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return e}}},{key:"compare",value:function(e,t){return JSON.stringify(e)===JSON.stringify(t)}},{key:"filter",value:function(e,t){return Object.keys(e).reduce((function(n,i){var r=e[i];return t(r)&&(n[i]=r),n}),{})}},{key:"isObject",value:function(e){return O(e)}},{key:"isArray",value:function(e){return function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}(e)}},{key:"isNumber",value:function(e){return P(e)}},{key:"isString",value:function(e){return function(e){return"string"==typeof e}(e)}},{key:"isEmpty",value:function(e){return!Object.keys(e).length}}]),e}();function F(e){for(var t=0,n=0,i=(e+="").length,r=0;r<i;r++)((t=31*t+e.charCodeAt(n++))>0x7fffffffffff||t<-0x800000000000)&&(t&=0xffffffffffff);return t<0&&(t+=0x7ffffffffffff),t}K.pluginName="official:profile";var J=function(e){var t=e;try{t=decodeURIComponent(e)}catch(e){}return t},W=function(e){var t={};return e&&e.split("&").forEach((function(e){if(e){var n=e.split("=");n[0]&&(t[n[0]]=n[1]||"")}})),t};T.usePlugin($),T.usePlugin(R),T.usePlugin(H),T.usePlugin(D),T.usePlugin(M),T.usePlugin(K);var B,z=function(e){r(s,e);var n=u(s);function s(){return t(this,s),n.apply(this,arguments)}return i(s,[{key:"appLaunch",value:function(){this.appShow()}},{key:"appTerminate",value:function(){this.appHide()}},{key:"appShow",value:function(){var e;void 0!==this.target.getLaunchOptionsSync&&(e=this.target.getLaunchOptionsSync()),this.emit(this.types.AppShow,e)}},{key:"appHide",value:function(){this.emit(this.types.AppHide)}},{key:"appError",value:function(e){this.emit(this.types.AppError,e)}},{key:"predefinePageview",value:function(){this.emit(this.types.PageShow)}},{key:"predefinePageviewHide",value:function(){this.emit(this.types.PageHide)}},{key:"shareAppMessage",value:function(e){try{var t=this.pluginInstances.find((function(e){return"official:auto"===e.constructor.pluginName}));if(t&&"function"==typeof t.pageShare)return t.pageShare(e)}catch(e){}return e}},{key:"setWebIDviaUnionID",value:function(e){if(!e||!this.option.get("enable_custom_webid"))return;var t=F(String(e).trim());this.config({web_id:t,wechat_unionid:e})}},{key:"setWebIDviaOpenID",value:function(e){if(!e||!this.option.get("enable_custom_webid"))return;var t=F(String(e).trim());this.config({web_id:t,wechat_openid:e})}},{key:"createWebViewUrl",value:function(e){if(!e||!this.ready)return e;var t=this.env.get("web_id");if(!t)return e;return this.processWebViewUrl(e,t)}},{key:"createWebViewUrlAsync",value:function(e){var t=this;if(!e)return Promise.resolve(e);return this.ready?Promise.resolve(this.processWebViewUrl(e,this.env.get("web_id"))):new Promise((function(n){t.on(t.types.Ready,(function(){n(t.processWebViewUrl(e,t.env.get("web_id")))}))}))}},{key:"processWebViewUrl",value:function(e,t){e=J(e);var n=/([^?#]+)(\?[^#]*)?(#.*)?/.exec(e),i=n[1]||"",r=n[2]||"",s=n[3]||"",o=r?W(r.substring(1)):{};return o.Web_ID=t,e=i+function(e,t){var n=e;if(t){var i=[];Object.keys(t).forEach((function(e){i.push("".concat(e,"=").concat(t[e]))})),i.length>0&&(n+="?".concat(i.join("&")))}return n}("",o)+s,e}}]),s}(T),G=console,Q="undefined",X=Q,Y=function(){if(X!==Q)return X;return X=("undefined"==typeof tt?"undefined":e(tt))!==Q?{target:tt,config:("undefined"==typeof __ttConfig?"undefined":e(__ttConfig))!==Q?__ttConfig:null,customPlatform:"ttMiniProduct",mpPlatform:2,is:"tt"}:("undefined"==typeof my?"undefined":e(my))!==Q?{target:my,config:null,customPlatform:"aliMiniProduct",mpPlatform:1,is:"my"}:("undefined"==typeof swan?"undefined":e(swan))!==Q?{target:swan,config:null,customPlatform:"swanMiniProduct",mpPlatform:5,is:"swan"}:("undefined"==typeof qq?"undefined":e(qq))!==Q?{target:qq,config:("undefined"==typeof __qqConfig?"undefined":e(__qqConfig))!==Q?__qqConfig:null,customPlatform:"qqMiniProduct",mpPlatform:6,is:"qq"}:("undefined"==typeof wx?"undefined":e(wx))!==Q?{target:wx,config:("undefined"==typeof __wxConfig?"undefined":e(__wxConfig))!==Q?__wxConfig:null,customPlatform:"miniProduct",mpPlatform:0,is:"wx"}:("undefined"==typeof uni?"undefined":e(uni))!==Q?{target:uni,config:null,customPlatform:"uniMiniProduct",mpPlatform:7,is:"uni"}:{target:{},config:null,customPlatform:"",mpPlatform:-1,is:""}},Z=Y(),ee="my"===Z.is?function(e){return function(t){var n=t.timeout||e.option.get("request_timeout"),i="number"==typeof n&&n>0;return new Promise((function(e,r){var s=my[my.request?"request":"httpRequest"](Object.assign(Object.assign({},t),{dataType:t.dataType||"json",success:function(t){e(t)},fail:function(e){r(e)}}));i&&setTimeout((function(){try{s&&s.abort()}catch(e){}}),n)}))}}:Z.target?function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n){return function(i){var r=i.timeout||n.option.get("request_timeout"),s="number"==typeof r&&r>0;return new Promise((function(n,o){var a=e.request(Object.assign(Object.assign(Object.assign({},i),s&&!t?{timeout:r}:{}),{dataType:i.dataType||"json",success:function(e){n(e)},fail:function(e){o(e)}}));s&&t&&setTimeout((function(){try{a&&a.abort()}catch(e){}}),r)}))}}}(Z.target,"swan"===Z.is):function(e){return function(e){return Promise.reject("request adapter error")}},te=function(){function e(n){t(this,e),this.target=n}return i(e,[{key:"get",value:function(e){var t=this;return new Promise((function(n,i){try{n(t.target.getStorageSync(e))}catch(e){i(e)}}))}},{key:"set",value:function(e,t){var n=this;return new Promise((function(i,r){try{n.target.setStorageSync(e,t),i(!0)}catch(e){r(!1)}}))}},{key:"remove",value:function(e){var t=this;return new Promise((function(n,i){try{t.target.removeStorageSync(e),n(!0)}catch(e){i(!1)}}))}}]),e}(),ne=Y(),ie=function(){function e(){t(this,e)}return i(e,[{key:"get",value:function(e){return new Promise((function(t,n){try{t(my.getStorageSync({key:e}).data)}catch(e){n(e)}}))}},{key:"set",value:function(e,t){return new Promise((function(n,i){try{my.setStorageSync({key:e,data:t}),n(!0)}catch(e){i(!1)}}))}},{key:"remove",value:function(e){return new Promise((function(t,n){try{my.removeStorageSync({key:e}),t(!0)}catch(e){n(!1)}}))}}]),e}(),re="my"===ne.is?new ie:ne.target?new te(ne.target):(B="storage adapter error",{get:function(e){return Promise.reject(B)},set:function(e,t){return Promise.reject(B)},remove:function(e){return Promise.reject(B)}}),se=function(){function e(){t(this,e)}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t,this.boost();var i=this.sdk.types;this.getInfo(),this.sdk.on(i.AppOpen,(function(){n.getInfo()}))}},{key:"boost",value:function(){}},{key:"getInfo",value:function(){var e=this,t=this.sdk,n=t.target,i=t.env;n&&(n.getSystemInfo&&n.getSystemInfo({success:function(t){var n={device_brand:t.brand,device_model:t.model,os_version:t.system,os_name:t.platform,platform:t.platform,resolution:"".concat(t.screenWidth,"x").concat(t.screenHeight),screen_width:t.screenWidth,screen_height:t.screenHeight};e.overlap(t,n),i.set(n)}}),n.getNetworkType&&n.getNetworkType({success:function(e){var t={access:e.networkType};i.set(t)}}))}},{key:"overlap",value:function(e,t){t.language=e.language,t.mp_platform_app_version=e.version,t.mp_platform_basic_version=e.SDKVersion}}]),e}();se.pluginName="official:device";var oe=function(e){r(o,e);var n=u(o);function o(){return t(this,o),n.apply(this,arguments)}return i(o,[{key:"boost",value:function(){h(s(o.prototype),"boost",this).call(this),this.which=Y(),this.sdk.target=this.which.target,this.sdk.targetEnvConfig=this.which.config,this.sdk.env.set({sdk_lib:"mp_common",custom_platform:this.which.customPlatform,mp_platform:this.which.mpPlatform})}},{key:"overlap",value:function(e,t){h(s(o.prototype),"overlap",this).call(this,e,t)}}],[{key:"init",value:function(e){var t=Y();e.platform=t.is?t.target:null,e.platformIs=t.is}}]),o}(se);z.useAdapterLog(G),z.useAdapterRequest(ee),z.useAdapterStorage(re),z.usePlugin(oe);var ae=function(){function e(){t(this,e),this.scenes=[1129]}return i(e,[{key:"apply",value:function(e,t){var n=this;if(this.sdk=e,this.options=t,!this.options.enable_filter_crawler)return;var i=this.sdk,r=i.target,s=i.types,o=function(e){n.scenes.includes(null==e?void 0:e.scene)&&n.sdk.set("is-crawler",!0)};try{if(r.getLaunchOptionsSync){var a=r.getLaunchOptionsSync();o(a)}}catch(e){}this.sdk.on(s.AppOpen,(function(e){o(e)}))}}]),e}();ae.pluginName="official:robot";var ue=function(){function e(){t(this,e),this.key="start_rangers_data_check",this.buffer=[],this.test=!1,this.testRequestNumber=0,this.interval=1e3,this.needOn=!1,this.onHandler=function(){}}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t;var i=this.sdk.types;this.sdk.once(i.AppOpen,(function(e){try{if(n.host=e,e.getLaunchOptionsSync){var t=e.getLaunchOptionsSync().query;n.verify(t).then((function(){n.needOn=!0,n.onHandler=function(e){n.submit(e)},n.sdk.on(i.Event,n.onHandler)}))}}catch(e){}})),this.sdk.on(i.AppClose,(function(){n.needOn&&(n.userInfo=null,n.sdk.off(i.Event,n.onHandler),n.onHandler=function(){},n.needOn=!1)}))}},{key:"check",value:function(e){var t;return null!==(t=null==e?void 0:e[this.key])&&void 0!==t?t:""}},{key:"verify",value:function(e){var t,n,i,r=this,s=this.sdk.adapter,o=new Promise((function(e){t=e})),a=function(e){t(!0),r.userInfo=e||{nickName:"未知",avatarUrl:""},s.log("verify open ".concat(JSON.stringify(r.userInfo))),r.login()},u=this.check(e);if(s.log("verify ".concat(u)),u){try{var c=(n="logverify",i=function(e){return(t=n,t.split("").map((function(e){return e.charCodeAt(0)}))).reduce((function(e,t){return e^t}),e);var t},function(e){return e.match(/.{1,2}/g).map((function(e){return parseInt(e,16)})).map(i).map((function(e){return String.fromCharCode(e)})).join("")})(u);c&&/^https?:\/\//.test(c)&&(this.domain=c),s.log("verify domain ".concat(c))}catch(e){}this.host.getSetting({success:function(e){s.log("getSetting success"),e.authSetting["scope.userInfo"]?(s.log("getSetting scope.userInfo success"),this.host.getUserInfo?this.host.getUserInfo({success:function(e){s.log("getUserInfo success");var t=e.userInfo,n=t.nickName,i=t.avatarUrl;a({nickName:n,avatarUrl:i})},fail:function(){s.log("getUserInfo fail"),a()}}):this.host.getOpenUserInfo&&this.host.getOpenUserInfo({success:function(e){s.log("getUserInfo success");try{var t=JSON.parse(e.response).response,n=t.nickName,i=t.avatar;a({nickName:n,avatarUrl:i})}catch(e){}},fail:function(){s.log("getUserInfo fail"),a()}})):(s.log("getSetting scope.userInfo fail"),a())},fail:function(){s.log("getSetting fail"),a()}})}return o}},{key:"submit",value:function(e){try{this.pushBuffer(JSON.parse(JSON.stringify(e)))}catch(e){}}},{key:"login",value:function(){var e=this;if(!this.domain)return;var t=this.prepareHeader().header;this.sdk.adapter.request({url:"".concat(this.domain,"/simulator/limited_mobile/try_link"),method:"POST",data:Object.assign(Object.assign({header:Object.assign(Object.assign({},t||{}),{aid:t.app_id})},this.userInfo?{nick_name:this.userInfo.nickName}:{}),{host_version:(t.custom||{}).mp_platform_app_version||"",sync_id:this.syncId||""})}).then((function(t){try{var n=t.data.data,i=n.retry,r=n.sync_id,s=n.token;if(e.syncId=r,e.token=s,e.test&&e.testRequestNumber>3)return e.report(),void 0;0===i||(1===i?e.loginLoop():2===i&&e.report())}catch(t){e.loginLoop()}})).catch((function(){e.loginLoop()}))}},{key:"loginLoop",value:function(){var e=this;this.test&&this.testRequestNumber++,setTimeout((function(){e.login()}),this.interval)}},{key:"report",value:function(){var e=this;if(!this.domain)return;var t=this.prepareHeader().header,n=this.buffer;this.buffer=[],this.sdk.adapter.request({url:"".concat(this.domain,"/simulator/limited_mobile/log"),method:"POST",data:{header:Object.assign(Object.assign({},t||{}),{aid:t.app_id}),token:this.token||"",event_v3:n||[]}}).then((function(t){try{!0===t.data.data.keep?e.reportLoop():e.reset()}catch(t){e.reportLoop()}})).catch((function(){e.reportLoop()}))}},{key:"reportLoop",value:function(){var e=this;setTimeout((function(){e.report()}),this.interval)}},{key:"pushBuffer",value:function(e){var t=this;(Array.isArray(e)?l(e):[e]).forEach((function(e){if("string"==typeof e.params)try{e.params=JSON.parse(e.params)}catch(e){}t.buffer.push(e)}))}},{key:"prepareHeader",value:function(){var e=this.sdk.env.get(),t=e.user,n=e.header;return JSON.parse(JSON.stringify({user:t,header:n}))}},{key:"reset",value:function(){this.buffer=[],this.syncId="",this.token=""}}]),e}();ue.pluginName="official:verify";var ce={cn:"https://abtest.volceapplog.com",va:"https://toblog.itobsnssdk.com",sg:"https://toblog.tobsnssdk.com"},he=function(){function e(){t(this,e),this.expire=2592e6,this.domains=ce,this.url="/service/2/abtest_config/",this.message={cb:"回调函数必须为一个函数",var:"变量名不能为空",value:"变量没有默认值"},this.fetchStatus=0,this.callbacks=[],this.data=null,this.versions=[],this.externalVersions=null,this.hasOn=!1,this.onHandler=function(){},this.changeListener=new Map,this.exposureName="abtest_exposure",this.clear=!1}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t;var i=this.sdk,r=i.adapter,s=i.types,o=i.appId;if(this.appId=o,this.externalKey=this.sdk.getKey("ab_version_external"),this.sdk.on(s.AbExternalVersion,(function(e){n.processExternal(e);var t=n.sdk.adapter;e?t.set(n.externalKey,e):t.remove(n.externalKey)})),r.get(this.externalKey).then((function(e){if(!e)return;try{n.processExternal(e)}catch(e){}})),!this.options.enable_ab_test)return;this.dataKey=this.sdk.getKey("ab_version"),this.clear=this.options.clear_ab_cache_on_user_change,this.domain=this.getDomain(),this.sdk.on(s.UuidChangeAfter,(function(){if(!n.sdk.ready)return;n.clear&&(n.versions=[],n.data={},n.updateVersions(),n.emitChange())})),this.sdk.once(s.Ready,(function(){n.preFetch(),n.sdk.on(s.UuidChangeAfter,(function(){n.preFetch()}))})),this.sdk.on(s.AbVar,(function(e){var t=e.name,i=e.defaultValue,r=e.callback;n.getVar(t,i,r)})),this.sdk.on(s.AbAllVars,(function(e){n.getAllVars(e)})),this.sdk.on(s.AbVersionChangeOn,(function(e){n.changeListener.set(e,e)})),this.sdk.on(s.AbVersionChangeOff,(function(e){n.changeListener.get(e)&&n.changeListener.delete(e)})),this.sdk.on(s.AbRefresh,(function(e){var t=e.params,i=e.callback;n.preFetch(t,i)})),r.get(this.dataKey).then((function(e){if(!e)return;var t=e.timestamp;if(A()-t>=n.expire)return n.sdk.adapter.remove(n.dataKey),void 0;try{var i=e.ab_version,r=e.data;2!==n.fetchStatus&&(n.versions=i||[],n.data=r,n.configVersions())}catch(e){}}))}},{key:"output",value:function(e){this.sdk.adapter.log(e)}},{key:"processExternal",value:function(e){this.externalVersions=e,this.sdk.set("ab_sdk_version_external",e)}},{key:"getAllVars",value:function(e){if("function"!=typeof e)return this.output(this.message.cb);var t={callback:e,type:1};2===this.fetchStatus?this._getAllVars(t):this.callbacks.push(t)}},{key:"getVar",value:function(e,t,n){if(!e)return this.output(this.message.var);if(void 0===t)return this.output(this.message.value);if("function"!=typeof n)return this.output(this.message.cb);var i={name:e,defaultValue:t,callback:function(e){try{n(e)}catch(e){}},type:0};2===this.fetchStatus?this._getVar(i):this.callbacks.push(i)}},{key:"fetchComplete",value:function(e){var t=this;if(e){this.data=e;var n=[];Object.keys(e).forEach((function(t){var i=e[t].vid;i&&n.push(i)}));var i=this.versions.length;i?(this.versions=this.versions.filter((function(e){return n.includes(e)})),this.versions.length!==i&&this.updateVersions()):this.updateVersions()}this.callbacks.forEach((function(e){return t[0===e.type?"_getVar":"_getAllVars"](e)})),this.callbacks=[]}},{key:"_getAllVars",value:function(e){(0,e.callback)(this.data?JSON.parse(JSON.stringify(this.data)):{})}},{key:"_getVar",value:function(e){var t=e.name,n=e.defaultValue,i=e.callback,r=this.data;if(!r)return i(n),void 0;if(O(r[t])){var s=r[t],o=s.vid,a=s.val;return o&&(this.versions.includes(o)||(this.versions.push(o),this.updateVersions(),this.emitChange()),this.sdk.emit(this.sdk.types.Event,Object.assign(Object.assign({},this.sdk.createEvent({event:this.exposureName},!1)),{ab_sdk_version:o}))),i(a),void 0}i(n)}},{key:"updateVersions",value:function(){this.configVersions(),this.sdk.adapter.set(this.dataKey,{data:this.data,ab_version:this.versions,timestamp:A()})}},{key:"configVersions",value:function(){var e=this.versions.join(",");this.sdk.set("ab_sdk_version",e);var t="ab_versions";this.sdk.set(t,[].concat(l(this.sdk.get(t)||[]),[{time:A(),ab:e}]))}},{key:"emitChange",value:function(){var e=this.versions.join(",");this.changeListener.size>0&&this.changeListener.forEach((function(t){"function"==typeof t&&setTimeout((function(){try{t(e)}catch(e){}}),0)}))}},{key:"getDomain",value:function(){var e,t=this.options,n=t.channel_domain,i=t.ab_channel_domain,r=null===(e=this.sdk.option.get("cloneOption"))||void 0===e?void 0:e.report_channel,s="";if(i)s=i;else if(n)s=n;else{var o=this.options.report_channel;Object.keys(this.domains).includes(o)||(o=r),s=this.domains[o]}return s}},{key:"preFetch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(!this.domain)return this.fetchStatus=2,this.fetchComplete(null),t&&t(null),void 0;var n=this.sdk.env,i=n.get(),r=i.user,s=i.header,o=s.headers,a=v(s,["headers"]);this.user=Object.assign({},r),this.fetch(Object.assign(Object.assign(Object.assign({},a),o),e||{})).then((function(e){return t&&t(e)}))}},{key:"fetch",value:function(e){var t=this;this.fetchStatus=1;var n=this.user.user_unique_id;return this.sdk.adapter.request({url:"".concat(this.domain).concat(this.url),method:"POST",data:{header:Object.assign(Object.assign({aid:this.appId},this.user||{}),e||{})}}).then((function(e){var i;if(t.user.user_unique_id!==n)return null;t.fetchStatus=2;var r=null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.data;return t.sdk.emit(t.sdk.types.AbFetchAfter,r),t.fetchComplete(r),r})).catch((function(){return t.fetchStatus=2,t.fetchComplete(null),null}))}}]),e}();he.pluginName="official:ab";var fe=function(){function e(){t(this,e),this.key="utm"}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t;var i=this.sdk.types;this.sdk.on(i.LaunchInfo,(function(e){var t,i;n.parseDefault(null!==(t=null==e?void 0:e.query)&&void 0!==t?t:{}),n.parseMore(null!==(i=null==e?void 0:e.query)&&void 0!==i?i:{})}))}},{key:"parseDefault",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=!1,i=Object.keys(t).reduce((function(i,r){return e.sdk.UtmType.includes(r)&&(n=!0,i[r]=J(t[r])),i}),{});n&&this.sdk.env.set(i)}},{key:"parseMore",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t||{},i=n.tr_token,r=void 0===i?"":i,s=n.surl_token,o=void 0===s?"":s,a=n.scene,u=void 0===a?"":a,c=r||o;if(u){var h=W(J("".concat(u)));h.tr_token&&(c=h.tr_token),this.sdk.set("scene_extra_query",h)}if(!c)return this.dispatch(),void 0;this.storageGet(c).then((function(t){t?(e.sdk.env.set(t.utms||{}),e.dispatch()):e.fetch(c).then((function(){return e.dispatch()})).catch((function(){return e.dispatch()}))})).catch((function(){e.fetch(c).then((function(){return e.dispatch()})).catch((function(){return e.dispatch()}))}))}},{key:"storageGet",value:function(e){var t=this.sdk.getKey(this.key),n=this.sdk.adapter;return n.get(t).then((function(i){var r=A(),s=[];if(Object.keys(i).forEach((function(e){i[e]&&i[e].timestamp+864e7<r&&s.push(e)})),s.length>0&&(s.forEach((function(e){delete i[e]})),n.set(t,i)),i&&i[e])return i[e];return null}))}},{key:"storageSet",value:function(e,t){var n=this.sdk.getKey(this.key),i=this.sdk.adapter;i.get(n).then((function(r){r||(r={}),r[e]={utms:t,timestamp:A()},i.set(n,r)}))}},{key:"fetch",value:function(e){var t=this,n=this.sdk,i=n.adapter,r=n.option,s=n.env,o=n.UtmType;return i.request({url:"".concat(r.get("domain"),"/service/2/mp_campaigns"),method:"GET",data:{tr_token:e},timeout:3e3}).then((function(n){var r=(n||{}).data,a=(r=void 0===r?{}:r).code,u=void 0===a?-1:a,c=r.data,h=void 0===c?{}:c,f=r.message,l=void 0===f?"":f;if(0===u){if(O(h)){var p=!1,d=Object.keys(h).reduce((function(e,t){return o.includes(t)&&(p=!0,d[t]=h[t]),e}),{});p&&s.set(d),t.storageSet(e,d)}}else 40002===u&&t.storageSet(e,{});0!==u&&i.log(l||"")}))}},{key:"dispatch",value:function(){this.sdk.emit(this.sdk.types.LaunchComplete)}}]),e}();fe.pluginName="official:utm";var le=function(){function e(){t(this,e),this.key="compensate",this.cache=new Map,this.batchMax=10,this.enable=!1,this.storageCache=new Map}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t,this.reportUrl=this.sdk.get("report_url"),this.enable=this.sdk.get("enable_storage"),this.options.enable_storage_only&&(this.enable=!0);var i=this.sdk.types;this.enable&&this.sdk.on(i.Ready,(function(){n.storageGet().then((function(e){if(!n.reportUrl||!e||!Array.isArray(e))return;var t=function(e){return new Promise((function(t){n.sdk.adapter.request({url:n.reportUrl,method:"POST",data:e}).then((function(){t(null)})).catch((function(){t(null)}))}))};if(e.length>50){var i=l(e);!function e(){var n=i.splice(0,50);n.length>0&&t(n).then((function(){i.length>0&&e()}))}()}else t(e)}))})),this.sdk.on(i.SubmitError,(function(e){var t=n.random(),i=e.event;n.cache.set(t,i),n.process()})),this.sdk.on(i.AppClose,(function(){n.report()}))}},{key:"process",value:function(){this.cache.size>=this.batchMax&&this.report()}},{key:"report",value:function(){var e=this;if(!this.reportUrl&&(this.reportUrl=this.sdk.get("report_url"),!this.reportUrl))return;var t=[];if(this.cache.forEach((function(e){t=[].concat(l(t),l(e))})),t.length>0){var n=this.random();this.enable&&this.storageCache.set(n,t),this.sdk.adapter.request({url:this.reportUrl,method:"POST",data:t}).then((function(){e.enable&&e.storageCache.delete(n)})).catch((function(){if(e.enable){var t=[];e.storageCache.forEach((function(e){t=[].concat(l(t),l(e))})),e.storageSet(t)}})),this.cache=new Map}}},{key:"storageGet",value:function(){var e=this.sdk.getKey(this.key),t=this.sdk.adapter;return t.get(e).then((function(n){if(t.remove(e),!O(n)||!n.timestamp)return null;var i=A();if(n.timestamp+864e7<i)return null;return n.data}))}},{key:"storageSet",value:function(e){var t=this.sdk.getKey(this.key);this.sdk.adapter.set(t,{data:e,timestamp:A()})}},{key:"random",value:function(){return"".concat(+new Date,"_").concat(Math.floor(1e10*Math.random()))}}]),e}();le.pluginName="official:compensate";var pe=function(){function e(){t(this,e)}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t;var i=this.sdk.types;this.options.disable_sdk_monitor||this.options.channel_domain||this.sdk.on(i.Ready,(function(){n.reportLoad()}))}},{key:"reportLoad",value:function(){var e=this.sdk.env.get(),t=e.user,n=e.header,i=this.sdk.env.merge([{event:"onload",params:Object.assign(Object.assign(Object.assign({},t),n),this.options)}]);i[0].header.app_id=1338,this.report(i)}},{key:"report",value:function(e){if(!this.reportUrl){var t=this.sdk.get("report_url");if(!t)return;t+=(t.indexOf("?")?"&":"?")+"type=monitor",this.reportUrl=t}this.sdk.adapter.request({url:this.reportUrl,method:"POST",header:{"X-MCS-AppKey":"566f58151b0ed37e"},data:e})}}]),e}();pe.pluginName="official:monitor";var de,ve,ge="mp_launch",ye="mp_enter",me="mp_exit",ke="purchase",_e="query",be="update_level",we="create_gamerole",Oe="check_out",Se="add_to_favourite",Pe={mpLaunch:function(e,t){e(ge,Object.assign({},t))},mpEnter:function(e,t){de=+new Date,e(ye,Object.assign({},t))},mpExit:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=getCurrentPages(),i=n[n.length-1].route,r=void 0===de?0:+new Date-de;e(me,Object.assign({duration:r,page_path:i},t)),de=void 0},purchase:function(e,t){e(ke,Object.assign({},t))},quest:function(e,t){e(_e,Object.assign({},t))},updateLevel:function(e,t){e(be,Object.assign({},t))},createGameRole:function(e,t){e(we,Object.assign({},t))},checkout:function(e,t){e(Oe,Object.assign({},t))},addToFavourite:function(e,t){e(Se,Object.assign({},t))}},Ae=function(){function e(){t(this,e)}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t,Object.keys(Pe).forEach((function(e){n.sdk[e]=Pe[e].bind(null,n.sdk.event.bind(n.sdk))}))}}]),e}();Ae.pluginName="official:extend",function(e){e.True="true",e.False="false"}(ve||(ve={}));var Ie=function(){function n(){t(this,n),this.queue=[],this.firstTime=ve.False,this.open=!1,this.launched=!1,this.autoConfig={appLaunch:!0,appTerminate:!0,appError:!0,pageShow:!0,pageHide:!0,pageShare:!0,pageFavorite:!0},this.missAppLaunch=!1,this.missAppShow=!1,n.instances.push(this)}return i(n,[{key:"apply",value:function(t,n){var i=this;this.sdk=t,this.options=n,this.open=!!this.options.auto_report,this.open&&"object"===e(this.options.auto_report)&&(this.autoConfig=Object.assign(Object.assign({},this.autoConfig),this.options.auto_report||{})),this.proxySetTitle();var r=this.sdk,s=r.types,o=r.adapter,a=this.sdk.getKey("first");o.get(a).then((function(e){if(e===ve.False)return i.firstTime=ve.False,void 0;e||(i.firstTime=ve.True),o.set(a,ve.False)})),this.sdk.on(s.Ready,(function(){i.queue.length>0&&(i.sdk.event(l(i.queue)),i.queue.length=0)})),this.sdk.on(s.AppOpen,(function(e){i.appLaunch(e)})),this.missAppLaunch&&this.appLaunch(this.missAppLaunchInfo),this.sdk.on(s.AppShow,(function(e){i.open&&i.autoConfig.appLaunch&&i.appShow(e)})),this.open&&this.autoConfig.appLaunch&&this.missAppShow&&this.appShow(this.missAppShowInfo),this.sdk.on(s.AppHide,(function(){i.open&&i.autoConfig.appTerminate&&i.appHide()})),this.sdk.on(s.AppError,(function(e){i.open&&i.autoConfig.appError&&i.appError(e)})),this.sdk.on(s.PageShow,(function(){var e=i.getRouteInfo();if(e){var t=e.path,n=e.query;i.sdk.env.set({evtParams:Object.assign({$current_path:t},n?{$current_query:JSON.stringify(n)}:{})})}i.open&&i.autoConfig.pageShow&&i.pageShow()})),this.sdk.on(s.PageHide,(function(){i.open&&i.autoConfig.pageHide&&i.pageHide()})),this.sdk.on(s.UuidChangeBefore,(function(){i.open&&i.autoConfig.appTerminate&&i.appHide()})),this.sdk.on(s.UuidChangeAfter,(function(){i.open&&i.autoConfig.appLaunch&&i.appShow(i.appInfo)}))}},{key:"event",value:function(e,t){this.sdk.ready?this.sdk.event(e,t):this.queue.push({event:e,params:t,local_time_ms:A()})}},{key:"proxySetTitle",value:function(){var e=this.sdk.target;if(!e)return;var t=this;try{var n=function(e){return function(){return function(n){try{var i=getCurrentPages(),r=i[i.length-1].route||"";O(n)||(n={});var s=t.sdk.get("title-caches")||{};s[r]=n.title,t.sdk.set("title-caches",s)}catch(e){}e.call(this,n)}}};if(void 0!==e.setNavigationBarTitle){var i=e.setNavigationBarTitle;Object.defineProperty(e,"setNavigationBarTitle",{get:n(i)})}else if(void 0!==e.setNavigationBar){var r=e.setNavigationBar;Object.defineProperty(e,"setNavigationBar",{get:n(r)})}}catch(e){}}},{key:"getPageTitle",value:function(e){var t=this.sdk.targetEnvConfig,n=this.sdk.get("title-caches"),i="";if(void 0!==(null==n?void 0:n[e])&&(i=n[e]),!i)try{if(t){var r=t.page[e]||t.page[e+".html"];r&&(i=r.window.navigationBarTitleText),i||(i=t.global.window.navigationBarTitleText)}}catch(e){}return i}},{key:"getRouteInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;try{var n=(t=t||getCurrentPages()).length-e;if(n<0)return null;var i=t[n],r=i.route,s=void 0===r?"":r,o=i.options,a=void 0===o?{}:o;return{path:s,query:a}}catch(e){}return null}},{key:"getCurrentPage",value:function(){var e=getCurrentPages()||[];return e[e.length-1]}},{key:"getQuery",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n={};if(O(t)){if(t.scene){var i=W(J("".concat(t.scene)));Object.keys(i).forEach((function(e){n["query_".concat(e)]=i[e]}))}Object.keys(t).forEach((function(i){if(!e.sdk.UtmType.includes(i)&&"scene"!==i){var r=t[i];"from_title"===i&&(r=encodeURIComponent(J(t[i]))),n["query_".concat(i)]=r}}))}return n}},{key:"fixInfo",value:function(e,t){var n=t;if(!t.path)if(t.args)n=t.args;else try{JSON.stringify(t)}catch(e){n={query:{}}}var i={info:n};return this.sdk.emit(this.sdk.types.TransformInfo,{type:e,rawInfo:t,wrapInfo:i}),n=i.info}},{key:"appLaunch",value:function(e){var t,n,i;this.appInfo=e||(null===(n=(t=this.sdk.target).getLaunchOptionsSync)||void 0===n?void 0:n.call(t)),this.appInfo=this.fixInfo("App.onLaunch",this.appInfo),this.scene=null===(i=this.appInfo)||void 0===i?void 0:i.scene,this.sdk.checkUsePlugin("official:utm")?this.sdk.emit(this.sdk.types.LaunchInfo,this.appInfo):this.sdk.emit(this.sdk.types.LaunchComplete)}}],[{key:"init",value:function(e){var t={onLaunch:function(t){e.instances.forEach((function(e){e.emit(e.types.AppOpen,t)})),n.instances.forEach((function(e){e.sdk||(e.missAppLaunch=!0,e.missAppLaunchInfo=t)}))},onShow:function(t){e.instances.forEach((function(e){e.emit(e.types.AppShowStart,t),e.emit(e.types.AppShow,t)})),n.instances.forEach((function(e){e.sdk||(e.missAppShow=!0,e.missAppShowInfo=t)}))},onHide:function(){e.instances.forEach((function(e){e.emit(e.types.AppHide),e.emit(e.types.AppClose)}))},onError:function(t){e.instances.forEach((function(e){e.emit(e.types.AppError,t)}))}},i={onShow:function(){e.instances.forEach((function(e){e.emit(e.types.PageShow)}))},onHide:function(){e.instances.forEach((function(e){e.emit(e.types.PageHide)}))},onUnload:function(){e.instances.forEach((function(e){e.emit(e.types.PageHide)}))},onShareAppMessage:function(e){var t=n.instances.length;if(!t)return e;var i=n.instances[t-1];if(!i.sdk||!i.open||!i.autoConfig.pageShare)return e;return i.pageShare(e)},onAddToFavorites:function(e){if(!n.instances.length)return;n.instances.forEach((function(t){if(!t.sdk||!t.open||!t.autoConfig.pageFavorite)return;t.pageFavorite(e)}))}};if(e.platform&&"swan"===e.platformIs&&App.after&&Page.after)return App.after({methods:Object.assign({},t)}),Page.after({methods:Object.assign({},i)}),void 0;var r=App;App=function(e){return Object.keys(t).forEach((function(n){var i=e[n];e[n]=function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];try{t[n].apply(this,r)}catch(e){}return i&&i.apply(this,r)}})),r(e)};var s=Page;if(Page=function(e){var t=i;return Object.keys(t).forEach((function(n){var i=e[n];"onShareAppMessage"===n?i&&(e[n]=function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];var o=i?i.apply(this,r):{};try{var a=t[n].apply(this,[o]);o.path=a.path}catch(e){}return o}):"onAddToFavorites"===n?i&&(e[n]=function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];var o=i?i.apply(this,r):{};try{t[n].apply(this,[{res:r[0],result:o}])}catch(e){}return o}):e[n]=function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];try{t[n].apply(this,r)}catch(e){}return i&&i.apply(this,r)}})),s(e)},"undefined"!=typeof Component){var o=Component;Component=function(e){e.methods||(e.methods={});var t=i;return Object.keys(t).forEach((function(n){var i=e.methods[n];"onShareAppMessage"===n?i&&(e.methods[n]=function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];var o=i?i.apply(this,r):{};try{var a=t[n].apply(this,[o]);o.path=a.path}catch(e){}return o}):"onAddToFavorites"===n?i&&(e.methods[n]=function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];var o=i?i.apply(this,r):{};try{t[n].apply(this,[{res:r[0],result:o}])}catch(e){}return o}):e.methods[n]=function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];try{t[n].apply(this,r)}catch(e){}return i&&i.apply(this,r)}})),o(e)}}}}]),n}();Ie.pluginName="official:auto",Ie.instances=[];var Ce=function(e){r(s,e);var n=u(s);function s(){var e;return t(this,s),(e=n.apply(this,arguments)).sessionStart=0,e.sessionDepth=0,e.shareDepth=0,e}return i(s,[{key:"appShow",value:function(e){e=e||this.appInfo,e=this.fixInfo("App.onShow",e);var t=this.sdk.sessionId;this.sessionStart=A();var n=e.query,i=(n=void 0===n?{}:n).share_depth,r=void 0===i?0:i;this.shareDepth=Number(r)||0;var s=this.sdk.EventType,o=e.referrerInfo,a=v(e,["referrerInfo"]),u=a.query,c=v(a,["query"]),h=Object.assign(Object.assign({},u),o),f=Object.assign(Object.assign(Object.assign({session_id:t,$is_first_time:this.firstTime},c),this.scene?{scene:this.scene}:{}),this.getQuery(h));this.sdk.emit(this.sdk.types.ExtendAppLaunch,f),this.event(s.appOnShow,f),this.firstTime===ve.True&&(this.firstTime=ve.False)}},{key:"appHide",value:function(){var e=this.getCurrentPage(),t=e.route,n=e.__route__,i=e.options,r=void 0===i?{}:i,s=t||n,o=Object.assign(Object.assign({exit_page:s,session_duration:Math.ceil((A()-this.sessionStart)/1e3),session_depth:this.sessionDepth,session_id:this.sdk.sessionId},this.scene?{scene:this.scene}:{}),this.getQuery(r));this.sdk.emit(this.sdk.types.ExtendAppTerminate,o),this.event(this.sdk.EventType.appOnHide,o)}},{key:"appError",value:function(e){var t={on_error:e,session_id:this.sdk.sessionId};this.sdk.emit(this.sdk.types.ExtendAppError,t),this.event(this.sdk.EventType.appOnError,t)}},{key:"pageShow",value:function(){this.sessionDepth+=1;var e=this.getCurrentPage(),t=e.route,n=e.__route__,i=e.options,r=void 0===i?{}:i,s=t||n,o=this.sdk.EventType,a=Object.assign(Object.assign({path:s,title:this.getPageTitle(s),session_id:this.sdk.sessionId},this.scene?{scene:this.scene}:{}),this.getQuery(r)),u=null;if(this.recentlyPage)u=this.recentlyPage;else{var c=this.getRouteInfo(2);c&&(u=c)}if(u){var h=u,f=h.path,l=void 0===f?"":f,p=h.query,d=void 0===p?{}:p;a.refer_path=l,a.refer_query=JSON.stringify(d)}this.sdk.emit(this.sdk.types.ExtendPageShow,a),this.recentlyPage={path:s,query:r},this.currentPvInfo={time:A(),params:Object.assign({},a)},this.event(o.pageOnShow,a)}},{key:"pageHide",value:function(){if(!this.currentPvInfo)return;var e=this.currentPvInfo,t=e.time,n=e.params;this.currentPvInfo=null;var i=A()-t;i=i<0?0:i;var r=Object.assign(Object.assign({},n||{}),{duration:i});this.sdk.emit(this.sdk.types.ExtendPageHide,r),this.event(this.sdk.EventType.pageOnHide,r)}},{key:"pageShare",value:function(e){var t=this.sdk.env.get().user.user_unique_id,n=this.shareDepth+1;if(e.path){var i=e.path,r="",s=i.indexOf("#");-1!==s&&(r=i.substr(s),i=i.substr(0,s));var o="from_user_unique_id=".concat(t,"&share_depth=").concat(n,"&from_title=").concat(e.title);i+="".concat(-1!==i.indexOf("?")?"&":"?").concat(o),e.path=i+r}var a=e.title,u=e.path,c=void 0===u?"":u,h={title:a,path:c,page_path:c.split("?")[0],query_share_depth:n,session_id:this.sdk.sessionId};return this.sdk.emit(this.sdk.types.ExtendPageShare,h),this.event(this.sdk.EventType.pageOnShareAppMessage,h),Object.assign(Object.assign({},e),{share_depth:n})}},{key:"pageFavorite",value:function(e){var t=e||{},n=t.res,i=t.result,r=getCurrentPages(),s=r[r.length-1],o=s.route,a=s.__route__,u=o||a,c=i.query,h=v(i,["query"]),f=Object.assign({url_path:(null==n?void 0:n.webViewUrl)||u,url_query:c},h);this.sdk.emit(this.sdk.types.ExtendPageFavorite,f),this.event(this.sdk.EventType.pageOnAddToFavorites,f)}}]),s}(Ie);return z.usePlugin(ae),z.usePlugin(ue),z.usePlugin(he),z.usePlugin(fe),z.usePlugin(le),z.usePlugin(pe),z.usePlugin(Ae),z.usePlugin(Ce),z}));
